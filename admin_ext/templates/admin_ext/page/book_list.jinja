{% extends "admin_ext/base/book_base.jinja" %}

{% block book_active_nav %}#book-nav-list{% endblock %}

{% block book_main %}
<div class="container">
{% from 'admin_ext/base/base_ctr.jinja' import pegination, search_form with context %}
    <div class="pull-left">
    {{ search_form() }}
    </div>
    <div class="pull-right">
    {{ pegination(books) }}
    </div>
    <table id="tb-data" class="table table-striped table-hover">
        <tr>
            <th order="id">ID</th>
            <th order="name">书名</th>
            <th order="author">作者</th>
            <th order="press">出版社</th>
            <th order="isbn">ISBN</th>
            <th order="status">状态</th>
            <th>库存</th>
        </tr>
        {% for book in books %}
        <tr>
            <td><a href="{{ url('admin_book_edit', id=book.id) }}" target="_blank" title="{{ book.id }}" >{{ book.id }}</a></td>
            <td><a href="{{ url('admin_book_edit', id=book.id) }}" target="_blank" title="{{ book.name }}" >{{ brief(book.name, 25) }}</a></td>
            <td><span title="{{ book.author }}">{{ brief(book.author, 15) }}</span></td>
            <td><span title="{{ book.press }}">{{ brief(book.press, 20) }}</span></td>
            <td><span title="{{ book.isbn }}">{{ brief(book.isbn, 15) }}</span></td>
            <td>
                <div class="btn-group">
                    <button class="btn btn-link dropdown-toggle" data-toggle="dropdown">
                        <span>{{ book.get_status_display() }}</span>
                        <span class="caret"></span>
                    </button>
                        <span>{{ string(book.__class__._meta.fields) }}</span>
                    <ul class="dropdown-menu"> 
                        {% for choice in book.__class__._meta.get_field('status').get_choices() %}
                        {% if choice[0] != '' and choice[0] != book.status %}
                        <li><a href="#" onClick="
                            $.get('{{ url('admin_book_set') }}', {'id':{{ book.id }}, 'status':{{ choice[0] }}},function(data, textStatus){ 
                                window.location.reload();
                            });
                            ">{{ choice[1] }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </td>
            <td>
                {% for logistic in book.get_logistic_info() %}
                <span class="label label-info">
                    {{ string(logistic.position) }}
                    <i class="icon-remove icon-white pointer" onClick="
                            $.get('{{ url('admin_logistic_delete') }}', {'id':{{ logistic.id }}},function(data, textStatus){ 
                                window.location.reload();
                            });
                        "></i>
                </span>
                {% endfor %}
                <span class="label label-info">
                    <i class="icon-plus icon-white pointer" onclick="
                        bootbox.prompt('请输入库位号', '取消', '提交', function(result) {
                            result = $.trim(result);
                            if ((result === null) || (result == '')) {
                            } else {
                                $.post('{{ url('admin_logistic_add') }}', {'id':{{ book.id }}, 'position':result},function(data, textStatus){ 
                                    window.location.reload();
                                });
                            }
                        });
                    "></i>
                </span>
            </td>
        </tr>
        {% endfor %}
        </div>
    </table>
    <form id="simple-create-book-form" class="form-horizontal" method="POST" action="{{ url('admin_book_create') }}">
        {% csrf_token %}
        <input type="hidden" id="name-input" name="name" value=""/>
        <input type="hidden" id="author-input" name="author" value=""/>
        <input type="hidden" id="press-input" name="press" value=""/>
        <input type="hidden" id="isbn-input" name="isbn" value=""/>
        <input type="hidden" id="position-input" name="position" value=""/>
        <input type="hidden" id="control-input" name="control" value=""/>
    </form>
    {{ pegination(books) }}
    <div class="navbar navbar-inverse navbar-fixed-bottom">
        <div class="navbar-inner">
            <div class="container">
                <div class="btn-toolbar pull-right">
                    <div class="btn-group dropup btn-wrapper">
                        <button class="btn btn-info" onclick="showSimpleCreateBookDialog();">{{ string('新增') }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
